let cbs_link = "https://opendata.cbs.nl/ODataApi/odata/70072ned/UntypedDataSet?$filter=((substringof(%27NL%27,RegioS)))&$select=Perioden,+TotaleBevolking_1";
let cbs_link2 = "https://odata4.cbs.nl/CBS/83878NED";
let cbs_link4 = "https://odata4.cbs.nl/CBS/84296NED";
let cbs_link_1 = cbs_link4+"/Observations";
let cbs_link_2 = cbs_link_1 +"/?$select=(Measure, Value)";
let cbs_link_3 = cbs_link_1 + "/?$top=50";

// Tabel generen
function addTable(data) {

    const myTableDiv = document.getElementById("myDynamicTable");
    const table = document.createElement('TABLE');
    table.border='1';

    const tableBody = document.createElement('TBODY');
    table.appendChild(tableBody);

    // Array voor de tabel headers
    keys = Object.keys(data[0]);
    var tr = document.createElement('TR');
    tableBody.appendChild(tr);

    for (let i=0; i<keys.length; i++) {
        var th =document.createElement("TH");
        th.append(document.createTextNode(keys[i]))
        tr.appendChild(th)
    }

    // Loop voor de data in de tabel  
    for (let i=0; i < data.length; i++){
        var tr = document.createElement('TR');
        tableBody.appendChild(tr);

        let row = data[i]
        let fields = Object.keys(row)

        fields.forEach(field => {
            
            var td = document.createElement('TD');
            td.appendChild(document.createTextNode(row[field]));
            tr.appendChild(td);
        });
        
    }
    myTableDiv.appendChild(table);
}

fetch(cbs_link_3).then((response) => {
    response.json().then((json) => {
        let data = json.value

        // filter values
/*
        let test2 = Object.keys(data[0])
        let newData = data[0][test2[0]]
        console.log('test2',test2)
        console.log('test',newData)

        for (let index = 0; index < data.length; index++) {
            let row = data[index];
            data[index]["Jaar"] = row.Perioden.slice(0,4)
        }

        console.log("Object after filters", data)
*/
        // generate the table and place it in the html
        addTable(data)

    })
}).catch((error) => {
    console.error("Couldnt fetch recource", error)
})
