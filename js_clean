let cbs_link = "https://opendata.cbs.nl/ODataApi/odata/70072ned/UntypedDataSet?$filter=((substringof(%27NL%27,RegioS)))&$select=Perioden,+TotaleBevolking_1";
let cbs_link2 = "https://odata4.cbs.nl/CBS/83878NED";

// Data laden
async function load_data() {
    const response = await fetch(cbs_link);
    const jsondata = await response.json();
    var data = jsondata.value;
}

// Tabel generen
function addTable(data) {

    const myTableDiv = document.getElementById("myDynamicTable");
    const table = document.createElement('TABLE');
    table.border='1';

    const tableBody = document.createElement('TBODY');
    table.appendChild(tableBody);

    // Array voor de tabel headers
    keys = Object.keys(data[0]);
    var tr = document.createElement('TR');
    tableBody.appendChild(tr);

    for (i=0; i<keys.length; i++) {

        var td =document.createElement("TD");
        td.append(document.createTextNode(keys[i]))
        tr.appendChild(td)
    }

    // Loop voor de data in de tabel  
    for (var i=0; i < data.length; i++){
        var tr = document.createElement('TR');
        tableBody.appendChild(tr);

        let row = data[i]
        let fields = Object.keys(row)

        fields.forEach(field => {
            
            var td = document.createElement('TD');
            td.appendChild(document.createTextNode(row[field]));
            tr.appendChild(td);
        });
        
    }
    myTableDiv.appendChild(table);
}



fetch(cbs_link).then((response) => {
    response.json().then((json) => {
        let data = json.value

        // filter values
        for (let index = 0; index < data.length; index++) {
            let row = data[index];
            data[index]["jaar"] = row.Perioden.slice(0,4)
        }

        console.log("Object after filters", data)

        // generate the table and place it in the html
        addTable(data)

    })
}).catch((error) => {
    console.error("Couldnt fetch recource", error)
})
